# API

you can also check the [**postman document**](https://documenter.getpostman.com/view/35373404/2sAY4vi3mW)
_( generated by postman ai )_

## Global Rules

- **all api share the same rate limit:** `20 requests per second for every ip address`

- **email rule:**

  - username part before @ (letters, numbers, dots, underscores, %, +, -)
  - @ symbol
  - domain name (letters, numbers, dots, hyphens)
  - TLD (top level domain) with at least 2 letters

- **password rule:**
  - at least 6 characters
  - at least one uppercase letter `A-Z`
  - at least one lowercase letter `a-z`
  - at least one number `0-9`
  - at least one special character `()[]{}<>+-\*/?,.:;"'\_\|~!@#$%^&=`
  - no more than 16 characters

## API LIST

- [Send OTP](#send-otp)
- [Register](#register)
- [Login](#login)
- [Refresh Token](#refresh-token)
- [Logout](#logout)
- [Get Recommendation](#get-recommendation)

## Send OTP

send OTP to user email for register or login.

- **POST** `/api/v1/auth/otp`

`FOR DEVELOPER: you can check the terminal log to get the otp code.`

#### Request

```json
{
  "email": "john.doe@example.com"
}
```

#### Response

```json
{
  "code": 200,
  "message": "success"
}
```

## Register

register user with email, password, and otp code.

**POST** `/api/v1/auth`

#### Request

```json
{
  "email": "john.doe@example.com",
  "password": "Password@123",
  "code": 123456
}
```

#### Response

```json
{
  "code": 200,
  "message": "success"
}
```

## Login

login user with email, password and otp code.

**POST** `/api/v1/auth/token`

#### HEADER:

| KEY         | TYPE   | DESCRIPTION | Required |
| ----------- | ------ | ----------- | :------: |
| X-Device-ID | string | device id   |    V     |

#### Request

```json
{
  "email": "john.doe@example.com",
  "password": "Password@123",
  "code": 123456
}
```

#### Response

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIs ... leHAiOjE2MTgwMzQ3NTQxNTZ9",
    "refresh_token": "eyJhbGciOiJIUzI1NiIs ... leHAiOjE2MTgwMzQ3NTQxNTZ9",
    "expires_in": 180
  }
}
```

## Refresh Token

refresh access token.

**PUT** `/api/v1/auth/token`

#### HEADER:

| KEY           | TYPE   | DESCRIPTION   | Required |
| ------------- | ------ | ------------- | :------: |
| X-Device-ID   | string | device id     |    V     |
| Authorization | string | refresh token |    V     |

#### Response

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIs ... leHAiOjE2MTgwMzQ3NTQxNTZ9",
  "refresh_token": "eyJhbGciOiJIUzI1NiIs ... leHAiOjE2MTgwMzQ3NTQxNTZ9",
  "expires_in": 180
}
```

## Logout

logout user.

**DELETE** `/api/v1/auth/token`

#### HEADER:

| KEY           | TYPE   | DESCRIPTION  | Required |
| ------------- | ------ | ------------ | :------: |
| X-Device-ID   | string | device id    |    V     |
| Authorization | string | access token |    V     |

#### Response

```json
{
  "code": 200,
  "message": "success"
}
```

## Get Recommendation

get user recommendation product list.

**GET** `/api/v1/product/recommendation`

#### HEADER:

| KEY           | TYPE   | DESCRIPTION  | Required |
| ------------- | ------ | ------------ | :------: |
| X-Device-ID   | string | device id    |    V     |
| Authorization | string | access token |    V     |

#### Query Params:

| KEY       | TYPE | DESCRIPTION | Required | Default |
| --------- | ---- | ----------- | :------: | :-----: |
| page      | int  | page        |    -     |    1    |
| page_size | int  | page size   |    -     |   20    |

#### Response

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "iPhone 15",
      "description": "最新款智慧型手機",
      "category_id": 1,
      "price": "799.99",
      "rank": 1,
      "created_at": 1677734399,
      "updated_at": 1677734399
    },
    {
      "id": 2,
      "name": "MacBook Air",
      "description": "輕薄筆電",
      "category_id": 1,
      "price": "999.99",
      "rank": 2,
      "created_at": 1677734399,
      "updated_at": 1677734399
    }
  ],
  "page": {
    "page": 1,
    "page_size": 20,
    "total_page": 1
  }
}
```
